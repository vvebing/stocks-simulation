{"version":3,"sources":["reportWebVitals.js","index.js","App.js"],"names":["reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","id","fallback","size","delay","App","document","getElementById","Login","lazy","Error","Finish","Notice","Practice","Dashboard","Preparation","PracticeTest","Questionnaire","STOCK","A","B","C","D","E","CLEAR_PASSWORD","props","login","uuid","groupID","localForage","setItem","setState","closeModal","noticed","showNotice","clearUserInfo","confirm","okText","cancelText","title","content","Password","onChange","event","clearPassword","target","value","onOk","a","warning","clear","trades","status","totalProfit","clearDashboard","removeItem","openNotice","goBack","state","error","window","location","reload","handleStart","stock","buy","sell","mood","handleNext","calcProfit","handleTrade","option","amount","latestData","length","updateKeys","newTrades","slice","splice","onQuestionSubmit","saveTextAsFile","data","fileText","JSON","stringify","fileTextAsBlob","Blob","type","downloadLink","createElement","download","innerHTML","webkitURL","href","createObjectURL","URL","onclick","body","removeChild","style","display","appendChild","click","handlePracticeNext","practice","loading","getItem","nextState","this","test","getExperimentStatus","active","subTitle","childComponent","tempStatus","backIcon","extra","onClick","danger","className","column","Item","label","visible","onCancel","PureComponent","calc","trade","principal","total","Array","isArray","cost","tCost","profit","position","i","balance","averageCost","marketValue","totalAsset","maxBuy","Math","floor","toFixed"],"mappings":"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","file":"static/js/main.19b2200b.chunk.js","sourcesContent":["const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React, { Suspense } from 'react';\nimport ReactDOM from 'react-dom';\nimport { Spin } from 'antd';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <div id=\"app\">\n      <Suspense fallback={<Spin size=\"large\" delay={100} />}>\n        <App />\n      </Suspense>\n    </div>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","import React, { lazy, PureComponent } from 'react';\nimport localForage from 'localforage';\nimport {\n  Button,\n  Descriptions,\n  Input,\n  message,\n  Modal,\n  PageHeader,\n  Skeleton,\n} from 'antd';\n\nimport data from './data.json';\n\nconst Login = lazy(() => import('./Login'));\nconst Error = lazy(() => import('./Error'));\nconst Finish = lazy(() => import('./Finish'));\nconst Notice = lazy(() => import('./Notice'));\nconst Practice = lazy(() => import('./Practice'));\nconst Dashboard = lazy(() => import('./Dashboard'));\nconst Preparation = lazy(() => import('./Preparation'));\nconst PracticeTest = lazy(() => import('./PracticeTest'));\nconst Questionnaire = lazy(() => import('./Questionnaire'));\n\nexport const STOCK = {\n  A: '甲',\n  B: '乙',\n  C: '丙',\n  D: '丁',\n  E: '戊',\n  Practice: '练习环节',\n};\nconst CLEAR_PASSWORD = '981107';\n\nexport default class App extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading: true,\n      uuid: '',\n      groupID: '',\n      noticed: false,\n      showNotice: false,\n      practice: {\n        // buy: [],\n        // sell: [],\n        // test: [],\n      },\n      trades: [],\n      /**\n       * [{\n       *  stock: A | B | C | D | E,\n       *  buy: [],  // length = 20\n       *  sell: [], // length = 20\n       *  mood: [], // length = 4\n       * }]\n       */\n      status: 0,\n      error: false,\n      totalProfit: 0,\n    };\n    this.clearPassword = '';\n  }\n\n  async componentDidMount() {\n    try {\n      const { uuid = '', groupID = '' } = await localForage.getItem('userInfo') ?? {};\n      const noticed = await localForage.getItem('noticed') ?? false;\n      const nextState = {\n        uuid,\n        groupID,\n        noticed,\n        showNotice: !noticed,\n        loading: false,\n      };\n      if (!uuid || !groupID) {\n        return this.setState(nextState);\n      }\n      const practice = await localForage.getItem('practice') ?? {};\n      nextState.practice = practice;\n      if (!practice.buy || !practice.sell || !practice.test) {\n        return this.setState(nextState);\n      }\n      const trades = await localForage.getItem('trades') ?? [];\n      const totalProfit = calcProfit(trades);\n      const status = getExperimentStatus(trades);\n      this.setState({\n        ...nextState,\n        trades,\n        status,\n        totalProfit,\n      });\n    } catch (err) {\n      this.setState({\n        error: true,\n        loading: false,\n      });\n    }\n  }\n\n  login = ({ uuid, groupID }) => {\n    localForage.setItem('userInfo', {\n      uuid,\n      groupID,\n    }, () => {\n      this.setState({\n        uuid,\n        groupID,\n      });\n    });\n  }\n\n  closeModal = () => {\n    localForage.setItem('noticed', true, () => {\n      this.setState({\n        noticed: true,\n        showNotice: false,\n      });\n    });\n  }\n\n  clearUserInfo = () => {\n    Modal.confirm({\n      okText: '确定',\n      cancelText: '取消',\n      title: '是否清除用户数据？',\n      content: [\n        <p key=\"text\">清除用户数据后也将会清除实验数据！请谨慎操作！</p>,\n        <p key=\"password\">请主试输入密码：<Input.Password onChange={(event) => {this.clearPassword = event.target.value}} /></p>,\n      ],\n      onOk: async () => {\n        if (this.clearPassword !== CLEAR_PASSWORD) {\n          message.warning('主试权限才能清除用户数据！');\n          return;\n        }\n        this.clearPassword = '';\n\n        await localForage.clear();\n        this.setState({\n          uuid: '',\n          groupID: '',\n          noticed: false,\n          showNotice: true,\n          trades: [],\n          status: 0,\n          totalProfit: 0,\n        });\n      },\n    });\n  }\n\n  clearDashboard = () => {\n    Modal.confirm({\n      okText: '确定',\n      cancelText: '取消',\n      title: '是否清除实验数据',\n      content: [\n        <p key=\"text\">清除实验数据后，您需要重新操作！请谨慎操作！</p>,\n        <p key=\"password\">请主试输入密码：<Input.Password onChange={(event) => {this.clearPassword = event.target.value}} /></p>,\n      ],\n      onOk: async () => {\n        if (this.clearPassword !== CLEAR_PASSWORD) {\n          message.warning('主试权限才能清除实验数据！');\n          return;\n        }\n        this.clearPassword = '';\n\n        await localForage.removeItem('trades');\n        this.setState({\n          trades: [],\n          status: 0,\n          totalProfit: 0,\n        });\n      },\n    });\n  }\n\n  openNotice = () => {\n    this.setState({ showNotice: true });\n  }\n\n  goBack = async () => {\n    const { status } = this.state;\n    if (status === -1) {\n      await localForage.removeItem('trades');\n      this.setState({\n        error: false,\n        trades: [],\n        status: 0,\n      });\n    } else {\n      window.location.reload();\n    }\n  }\n\n  handleStart = (stock) => {\n    this.setState((state) => ({\n      trades: [...state.trades, {\n        stock,\n        buy: [300],\n        sell: [0],\n        mood: [],\n      }],\n      status: 1,\n    }), () => {\n      const { trades } = this.state;\n      localForage.setItem('trades', trades);\n    });\n  }\n\n  handleNext = () => {\n    const { trades } = this.state;\n    const totalProfit = calcProfit(trades);\n    this.setState({\n      status: 2,\n      totalProfit,\n    });\n  }\n\n  handleTrade = (option, amount) => {\n    const { trades } = this.state;\n    const latestData = trades[trades.length - 1];\n    if (latestData) {\n      const { buy, sell, mood } = latestData;\n      if (buy.length !== sell.length) {\n        return this.setState({ status: -1 });\n      }\n      if (buy.length >= 20) {\n        if (mood.length < 4) {\n          this.setState({ status: 2 });\n        } else {\n          this.setState({ status: 3 });\n        }\n      } else {\n        const updateKeys = {};\n        if (option === 'buy') {\n          updateKeys.buy = [...buy, amount];\n          updateKeys.sell = [...sell, 0];\n        } else if (option === 'sell') {\n          updateKeys.buy = [...buy, 0];\n          updateKeys.sell = [...sell, amount];\n        } else {\n          updateKeys.buy = [...buy, 0];\n          updateKeys.sell = [...sell, 0];\n        }\n        const newTrades = trades.slice();\n        newTrades.splice(-1, 1, {\n          ...latestData,\n          ...updateKeys,\n        });\n        this.setState({\n          trades: newTrades,\n        }, () => {\n          localForage.setItem('trades', newTrades);\n        });\n      }\n    } else {\n      this.setState({ status: 0 });\n    }\n  }\n\n  onQuestionSubmit = (mood) => {\n    const { trades } = this.state;\n    const latestData = trades[trades.length - 1];\n    if (!latestData) {\n      return this.setState({\n        status: -1,\n      });\n    }\n    const newTrades = trades.slice();\n    newTrades.splice(-1, 1, {\n      ...latestData,\n      mood,\n    });\n    this.setState({\n      trades: newTrades,\n      status: newTrades.length >= 5 ? 3 : 0,\n    }, () => {\n      localForage.setItem('trades', newTrades);\n    });\n  }\n\n  saveTextAsFile = () => {\n    const { uuid, groupID, trades } = this.state;\n    saveTextAsFile({\n      uuid,\n      groupID,\n      trades,\n    }, uuid, groupID);\n  }\n\n  handlePracticeNext = (practice) => {\n    this.setState((state) => ({\n      practice: {\n        ...state.practice,\n        ...practice,\n      },\n    }), () => {\n      const { practice } = this.state;\n      localForage.setItem('practice', practice);\n    });\n  }\n\n  render() {\n    const {\n      loading,\n      error,\n      uuid,\n      groupID,\n      noticed,\n      showNotice,\n      trades,\n      status,\n      practice,\n      totalProfit,\n     } = this.state;\n\n    if (loading) {\n      return <div id=\"skeleton\"><Skeleton active /></div>;\n    }\n\n    if (error || status === -1) {\n      return <Error status={status} goBack={this.goBack} />;\n    }\n\n    if (!uuid || !groupID) {\n      return <Login login={this.login} />;\n    }\n\n    let subTitle = '';\n    let childComponent = null;\n    const tempStatus = status;\n\n    if (!practice.buy || !practice.sell) {\n      subTitle = \"练习操作\";\n      childComponent = <Practice handlePracticeNext={this.handlePracticeNext} />;\n    } else if (!practice.test) {\n      subTitle = \"练习测验\";\n      childComponent = <PracticeTest handlePracticeNext={this.handlePracticeNext} />;\n    } else {\n      switch(tempStatus) {\n        case 0: {\n          subTitle = `即将开始第${trades.length + 1}轮实验`;\n          childComponent = <Preparation trades={trades} groupID={groupID} handleStart={this.handleStart} />;\n          break;\n        }\n        case 1: {\n          subTitle = `正在进行第${trades.length}轮实验`;\n          childComponent = <Dashboard trades={trades} handleTrade={this.handleTrade} handleNext={this.handleNext} />;\n          break;\n        }\n        case 2: {\n          subTitle = `已结束第${trades.length}轮实验`;\n          childComponent = <Questionnaire groupID={groupID} onQuestionSubmit={this.onQuestionSubmit} />;\n          break;\n        }\n        case 3: {\n          subTitle = `所有实验已结束`;\n          childComponent = <Finish totalProfit={totalProfit} saveTextAsFile={this.saveTextAsFile} />;\n          break;\n        }\n        default:\n          break;\n      }\n    }\n\n    return (\n      <div id=\"main\">\n        <PageHeader\n          backIcon={false}\n          title=\"股票模拟交易实验\"\n          subTitle={subTitle}\n          extra={[\n            <Button key=\"notice\" type=\"link\" onClick={this.openNotice}>实验须知</Button>,\n            <Button key=\"userInfo\" danger type=\"primary\" onClick={this.clearUserInfo}>清除用户数据</Button>,\n            <Button key=\"trades\" danger onClick={this.clearDashboard}>清除实验数据</Button>,\n          ]}\n        >\n          <div className=\"content\">\n            <Descriptions size=\"small\" column={2}>\n              <Descriptions.Item label=\"被试编号\">\n                {uuid}\n              </Descriptions.Item>\n              <br />\n              <Descriptions.Item label=\"分组编号\">\n                {groupID}\n              </Descriptions.Item>\n            </Descriptions>\n          </div>\n        </PageHeader>\n        {childComponent}\n        <Notice\n          noticed={noticed}\n          visible={showNotice}\n          onCancel={this.closeModal}\n        />\n      </div>\n    );\n  }\n}\n\n/**\n * 传入实验数据返回当前实验状态\n * @param {Array} trades 实验数据\n * @returns {(-1|0|1|2|3)} 实验状态\n */\nfunction getExperimentStatus(trades) {\n  let status;\n  const latestData = trades[trades.length - 1];\n  const {\n    buy = [],\n    sell = [],\n    mood = [],\n  } = latestData || {};\n  if (!latestData) {\n    status = 0;\n  } else if (\n    buy.length >= 20 ||\n    sell.length >= 20\n  ) {\n    if (mood.length < 4) {\n      status = 2;\n    } else if (trades.length >= 5) {\n      status = 3;\n    } else {\n      status = 0;\n    }\n  } else if (\n    buy.length < 20 &&\n    buy.length === sell.length &&\n    mood.length === 0\n  ) {\n    status = 1;\n  } else {\n    status = -1;\n  }\n  return status;\n}\n\nexport function calc(trade, principal = 5000, total = false) {\n  const { stock, buy, sell } = trade;\n  if (\n    !stock\n    || !Array.isArray(buy)\n    || !Array.isArray(sell)\n    || (total && (buy.length < 20 || sell.length < 20))\n  ) {\n    return {};\n  }\n  let cost = 0;\n  let tCost = 0;\n  let amount = 0;\n  let profit = 0;\n  let position = 0;\n  for (let i = 0; i < buy.length; i += 1) {\n    cost += buy[i] * data[stock][i + 3];\n    if (sell[i] === position && position !== 0) {\n      tCost = 0;\n      amount = 0;\n    } else {\n      tCost += buy[i] * data[stock][i + 3];\n      amount += buy[i];\n    }\n    position += buy[i] - sell[i];\n    profit += sell[i] * data[stock][i + 3];\n  }\n  const balance = principal + profit - cost;\n  const averageCost = amount <= 0 ? 0 : (tCost / amount);\n  const marketValue = position * data[stock][buy.length + 3];\n  const totalAsset = balance + marketValue;\n  const totalProfit = totalAsset - principal;\n  const maxBuy = Math.floor(balance / data[stock][buy.length + 3])\n  return {\n    averageCost,\n    position,\n    totalProfit,\n    balance,\n    marketValue,\n    totalAsset,\n    maxBuy,\n  };\n}\n\nfunction calcProfit(trades) {\n  let totalProfit = 0;\n  for (let i = 0; i < trades.length; i += 1) {\n    const { totalProfit: profit = 0 } = calc(trades[i], 5000, true);\n    totalProfit += profit;\n  }\n  return +totalProfit.toFixed(2);\n}\n\nfunction saveTextAsFile(data, uuid, groupID) {\n  const fileText = JSON.stringify(data);\n  const fileTextAsBlob = new Blob([fileText], {type: 'text/plain'});\n  const downloadLink = document.createElement('a');\n  downloadLink.download = `stocks-simulation-${uuid}-${groupID}.txt`;\n  downloadLink.innerHTML = 'Download File';\n  if (window.webkitURL !== null) {\n    // Chrome allows the link to be clicked\n    // without actually adding it to the DOM.\n    downloadLink.href = window.webkitURL.createObjectURL(fileTextAsBlob);\n  } else {\n    // Firefox requires the link to be added to the DOM\n    // before it can be clicked.\n    downloadLink.href = window.URL.createObjectURL(fileTextAsBlob);\n    downloadLink.onclick = (event) => {\n      document.body.removeChild(event.target);\n    };\n    downloadLink.style.display = 'none';\n    document.body.appendChild(downloadLink);\n  }\n  downloadLink.click();\n}\n"],"sourceRoot":""}